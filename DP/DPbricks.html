<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SER - Arquitectura de Desarrollo Profesional</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Cabin:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --ser-pink: #E11B7E;
            --ser-yellow: #FCCC32;
            --ser-cyan: #009BD1;
            --ser-dark: #1A1A1A;
            --ser-bg: #F0F2F5;
        }

        body {
            font-family: 'Cabin', sans-serif;
            background-color: var(--ser-bg);
            color: var(--ser-dark);
            font-size: 18px;
        }

        .font-bebas { font-family: 'Bebas Neue', sans-serif; }

        .custom-scrollbar::-webkit-scrollbar { height: 10px; width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #e0e0e0; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: var(--ser-cyan); border-radius: 10px; }

        /* Pieza de Rompecabezas SER */
        .puzzle-piece {
            clip-path: path('M 0 0 L 160 0 Q 180 0 180 15 L 180 40 Q 195 55 180 70 L 180 95 Q 180 115 160 115 L 0 115 Q 20 100 20 70 Q 5 55 20 40 Q 20 15 0 0 Z');
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .active-brick {
            filter: brightness(1.1);
            transform: scale(1.05) translateY(-8px);
            z-index: 50 !important;
        }

        .bg-ser-pink { background-color: var(--ser-pink); }
        .bg-ser-yellow { background-color: var(--ser-yellow); }
        .bg-ser-cyan { background-color: var(--ser-cyan); }
        .bg-ser-dark { background-color: var(--ser-dark); }
        
        .btn-delete {
            background-color: rgba(225, 27, 126, 0.9);
            transition: all 0.2s;
        }
        
        .btn-delete:hover {
            background-color: #ff0000;
            transform: scale(1.1);
        }

        .brick-shadow {
            filter: drop-shadow(0 10px 8px rgb(0 0 0 / 0.1));
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Header Institucional -->
    <header class="p-4 md:p-6 bg-white border-b-4 border-neutral-100 shadow-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center gap-6">
                <div class="font-bebas text-6xl tracking-tighter leading-none select-none flex">
                    <span style="color: var(--ser-pink)">s</span><span style="color: var(--ser-yellow)">e</span><span style="color: var(--ser-cyan)">r</span>
                </div>
                <div class="hidden lg:block h-14 w-px bg-neutral-200"></div>
                <div class="hidden md:block">
                    <h1 class="font-bebas text-3xl tracking-wide text-neutral-800 leading-none">ARQUITECTURA DE DESARROLLO PROFESIONAL</h1>
                    <p class="text-[10px] uppercase tracking-[0.4em] font-bold text-neutral-400 mt-1 italic">Superación | Excelencia | Resultados</p>
                </div>
            </div>
            <button id="shuffle-btn" class="flex items-center gap-2 px-6 py-3 bg-ser-dark hover:bg-neutral-800 text-white rounded-full text-xs font-bold uppercase tracking-widest transition-all shadow-lg active:scale-95">
                <i data-lucide="shuffle" class="w-4 h-4"></i> <span id="shuffle-text">Revolver Librería</span>
            </button>
        </div>
    </header>

    <main class="flex-1 flex flex-col p-4 md:p-8 gap-8 max-w-7xl mx-auto w-full">
        
        <!-- Toolbox Superior -->
        <section class="bg-white p-6 rounded-[2.5rem] shadow-sm border border-neutral-200">
            <div class="mb-6 flex justify-between items-center px-4">
                <h2 class="text-xs font-black text-neutral-400 uppercase tracking-widest flex items-center gap-2 leading-none">
                    <i data-lucide="layout-grid" class="w-4 h-4 text-ser-pink"></i> Librería de Técnicas
                </h2>
                <div id="challenge-label" class="hidden text-[11px] text-ser-pink font-black uppercase tracking-tighter animate-pulse">
                    Modo Desafío
                </div>
            </div>

            <div id="library-container" class="grid grid-cols-2 md:grid-cols-5 gap-5">
                <!-- JS Fill -->
            </div>
        </section>

        <!-- Timeline (Rompecabezas) -->
        <section class="flex-1 bg-white border-2 border-dashed border-neutral-300 rounded-[3rem] p-10 flex flex-col min-h-[300px] overflow-hidden relative shadow-inner">
            <div class="flex items-center justify-between mb-8 px-6">
                <h2 class="font-bebas text-3xl tracking-widest text-neutral-300 uppercase">Secuencia del Taller</h2>
                <button id="clear-btn" class="text-xs text-neutral-400 hover:text-ser-pink font-black uppercase tracking-widest flex items-center gap-2 transition-colors">
                    <i data-lucide="trash-2" class="w-4 h-4"></i> Borrar Todo
                </button>
            </div>
            
            <div id="timeline-container" class="flex-1 overflow-x-auto flex items-center custom-scrollbar px-10 min-h-[160px]">
                <!-- JS Fill -->
            </div>
        </section>

        <!-- Debugger e Inspector -->
        <section class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-10">
            <!-- Terminal Debugger -->
            <div class="bg-ser-dark rounded-[2.5rem] p-8 shadow-2xl flex flex-col h-[400px] text-white border-t-4 border-ser-pink">
                <h3 class="text-[11px] font-black text-neutral-500 uppercase tracking-[0.4em] mb-6 flex items-center gap-3">
                    <i data-lucide="terminal" class="text-ser-cyan w-5 h-5"></i> Pedagogical Debugger
                </h3>
                <div id="debugger-console" class="flex-1 overflow-y-auto space-y-4 pr-2 custom-scrollbar">
                    <!-- Dinámico -->
                </div>
            </div>

            <!-- Inspector de Técnicas -->
            <div id="inspector-panel" class="bg-white rounded-[2.5rem] p-8 shadow-xl border-t-4 border-ser-yellow h-[400px] overflow-hidden flex flex-col">
                <!-- Dinámico -->
            </div>
        </section>
    </main>

    <script>
        const CATEGORY_DATA = {
            EJECUCION: { label: 'Ejecución', color: 'text-indigo-400', brickClass: 'bg-ser-dark' },
            VER: { label: 'Ver', color: 'text-ser-cyan', brickClass: 'bg-ser-cyan' },
            NOMBRAR: { label: 'Nombrar', color: 'text-ser-yellow', brickClass: 'bg-ser-yellow' },
            HACER: { label: 'Hacer', color: 'text-ser-pink', brickClass: 'bg-ser-pink' },
            REFLEXIONAR: { label: 'Reflexionar', color: 'text-zinc-400', brickClass: 'bg-ser-gray' }
        };

        const BRICK_DEFS = {
            OBJETIVO: { id: 'OBJETIVO', category: 'EJECUCION', label: 'Objetivo', icon: 'target', description: 'Meta de la sesión.', reflection: '¿Es este objetivo claro, medible y realizable en el tiempo?', impact: 'Alineación estratégica.' },
            HISTORIA: { id: 'HISTORIA', category: 'EJECUCION', label: 'Historia', icon: 'book-open', description: 'Conexión humana inicial.', reflection: '¿Uso el "nosotros" colectivo? ¿Honro la experiencia del equipo?', impact: 'Apertura emocional.' },
            PRESENCIA: { id: 'PRESENCIA', category: 'EJECUCION', label: 'Cara Abierta', icon: 'smile', description: 'Lenguaje corporal del líder.', reflection: '¿Mantengo las cejas levantadas y una sonrisa tranquila?', impact: 'Seguridad psicológica.' },
            BOCADO: { id: 'BOCADO', category: 'EJECUCION', label: 'Bocado', icon: 'layers', description: 'Instrucciones cortas.', reflection: '¿Dividí la instrucción? ¿Tienen claro qué hacer ahora mismo?', impact: 'Claridad ejecutiva.' },
            PAUSA: { id: 'PAUSA', category: 'EJECUCION', label: 'Pausa', icon: 'timer', description: 'Silencio estratégico.', reflection: '¿Hice el silencio justo después de la línea maestra?', impact: 'Fijación cognitiva.' },
            
            ENFOQUE: { id: 'ENFOQUE', category: 'VER', label: 'Enfoque', icon: 'help-circle', description: 'Pregunta previa al modelo.', reflection: '¿La pregunta enfoca las acciones positivas que deben observar?', impact: 'Observación útil.' },
            MODELO_VIDEO: { id: 'MODELO_VIDEO', category: 'VER', label: 'Video', icon: 'video', description: 'Modelo externo de éxito.', reflection: '¿El video dura menos de 5 min? ¿Está listo para proyectar?', impact: 'Validación visual.' },
            MODELO_LIDER: { id: 'MODELO_LIDER', category: 'VER', label: 'Líder Modela', icon: 'user-check', description: 'El facilitador actúa.', reflection: '¿Muestro el error común para que el equipo lo detecte?', impact: 'Referente directo.' },

            GIRA_DISCUTE: { id: 'GIRA_DISCUTE', category: 'NOMBRAR', label: 'Gira/Discute', icon: 'message-square', description: 'Procesamiento activo.', reflection: '¿Dí instrucciones claras de quién empieza la charla?', impact: 'Ratio de pensamiento.' },
            PREGUNTAR_VALOR: { id: 'PREGUNTAR_VALOR', category: 'NOMBRAR', label: '¿Valor?', icon: 'zap', description: 'Lógica del propósito.', reflection: '¿Pregunté "¿Qué hubiera pasado si no hiciéramos eso?"?', impact: 'Apropiación lógica.' },
            NOMBRAR_TECNICO: { id: 'NOMBRAR_TECNICO', category: 'NOMBRAR', label: 'Nombre Técnico', icon: 'type', description: 'Asignar lenguaje formal.', reflection: '¿Esperé a que ellos descubrieran la idea antes del nombre?', impact: 'Estandarización.' },

            GUION: { id: 'GUION', category: 'HACER', label: 'Hacer Guion', icon: 'pen-tool', description: 'Planear señales y palabras.', reflection: '¿Dí tiempo para escribir el guion antes de pedirles actuar?', impact: 'Práctica segura.' },
            PRACTICA_BRECHA: { id: 'PRACTICA_BRECHA', category: 'HACER', label: 'Práctica', icon: 'user-round', description: 'Juego de roles activo.', reflection: '¿Estoy circulando con el ejemplar en mano para dar feedback?', impact: 'Transferencia real.' },
            DE_NUEVO: { id: 'DE_NUEVO', category: 'HACER', label: 'De Nuevo', icon: 'refresh-ccw', description: 'Pulir hasta la maestría.', reflection: '¿Nombre el error común antes de pedir repetir la ronda?', impact: 'Cultura de excelencia.' },

            REFLEXIONAR: { id: 'REFLEXIONAR', category: 'REFLEXIONAR', label: 'Reflexión', icon: 'pen-tool', description: 'Sellar el aprendizaje.', reflection: '¿Limite la escritura a 1 o 2 minutos para sellar la idea?', impact: 'Anclaje cognitivo.' },
            PLAN_ACCION: { id: 'PLAN_ACCION', category: 'REFLEXIONAR', label: 'Plan Mañana', icon: 'file-text', description: 'Compromiso de aula.', reflection: '¿Anotamos cuándo observaré esta técnica en el aula real?', impact: 'Responsabilidad.' }
        };

        let sequence = [];
        let selectedIdx = null;
        let previewItem = null;
        let isShuffled = false;
        let libraryKeys = Object.keys(BRICK_DEFS);

        const libContainer = document.getElementById('library-container');
        const timelineContainer = document.getElementById('timeline-container');
        const debuggerConsole = document.getElementById('debugger-console');
        const inspectorPanel = document.getElementById('inspector-panel');

        function renderLibrary() {
            libContainer.innerHTML = '';
            if (isShuffled) {
                libContainer.className = 'flex flex-wrap gap-4 animate-in fade-in duration-300';
                libraryKeys.forEach(k => libContainer.appendChild(createBrickBtn(k)));
            } else {
                libContainer.className = 'grid grid-cols-2 md:grid-cols-5 gap-6';
                Object.keys(CATEGORY_DATA).forEach(catKey => {
                    const col = document.createElement('div');
                    col.className = 'space-y-3';
                    col.innerHTML = `<h3 class="text-[10px] font-black uppercase tracking-widest ${CATEGORY_DATA[catKey].color} border-b-2 border-neutral-50 pb-2">${CATEGORY_DATA[catKey].label}</h3>`;
                    const list = document.createElement('div');
                    list.className = 'flex flex-col gap-2.5';
                    Object.keys(BRICK_DEFS).filter(k => BRICK_DEFS[k].category === catKey).forEach(k => list.appendChild(createBrickBtn(k)));
                    col.appendChild(list);
                    libContainer.appendChild(col);
                });
            }
            lucide.createIcons();
        }

        function createBrickBtn(key) {
            const brick = BRICK_DEFS[key];
            const wrap = document.createElement('div');
            wrap.className = 'relative group';
            const btn = document.createElement('button');
            btn.className = `${CATEGORY_DATA[brick.category].brickClass} w-full py-3.5 px-5 rounded-2xl flex items-center gap-3 shadow-md hover:brightness-110 active:scale-95 transition-all text-white border border-white/10`;
            btn.innerHTML = `<i data-lucide="${brick.icon}" class="w-5 h-5 opacity-90"></i><span class="font-bold text-[13px] uppercase tracking-tighter truncate">${brick.label}</span>`;
            btn.onclick = () => addBrick(key);
            
            const info = document.createElement('button');
            info.className = 'absolute -right-2 -top-2 p-2 bg-white text-ser-dark shadow-lg rounded-full opacity-0 group-hover:opacity-100 transition-all z-10 border border-neutral-200';
            info.innerHTML = '<i data-lucide="info" class="w-4 h-4"></i>';
            info.onclick = (e) => { e.stopPropagation(); previewItem = brick; selectedIdx = null; updateInspector(); };
            
            wrap.appendChild(btn); wrap.appendChild(info);
            return wrap;
        }

        function addBrick(key) {
            sequence.push({...BRICK_DEFS[key], instanceId: Math.random()});
            previewItem = null; renderTimeline(); updateAnalysis();
        }

        function renderTimeline() {
            timelineContainer.innerHTML = '';
            if (sequence.length === 0) {
                timelineContainer.innerHTML = '<div class="w-full text-center opacity-30 py-10 font-bold uppercase text-sm tracking-[0.4em] text-neutral-400 italic">Diseña tu flujo de excelencia aquí</div>';
                return;
            }
            const wrapper = document.createElement('div');
            wrapper.className = 'flex items-center';
            sequence.forEach((brick, idx) => {
                const piece = document.createElement('div');
                piece.className = `relative flex-shrink-0 w-[190px] h-[115px] p-6 transition-all cursor-pointer flex flex-col justify-center puzzle-piece brick-shadow ${CATEGORY_DATA[brick.category].brickClass} ${selectedIdx === idx ? 'active-brick z-40' : 'z-10 opacity-90 hover:opacity-100'}`;
                piece.style.marginLeft = idx === 0 ? '0' : '-28px';
                piece.onclick = () => { selectedIdx = idx; previewItem = null; renderTimeline(); updateInspector(); };
                
                piece.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <div class="bg-black/20 p-2 rounded-xl text-white"><i data-lucide="${brick.icon}" class="w-6 h-6"></i></div>
                        <button onclick="event.stopPropagation(); removeBrick(${idx})" class="p-2.5 bg-red-600 hover:bg-red-700 rounded-full text-white shadow-xl transition-all btn-action-overlay border border-white/20">
                            <i data-lucide="trash-2" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <h4 class="font-bebas text-2xl tracking-wider text-white leading-none truncate">${brick.label}</h4>
                    
                    <div class="absolute -bottom-12 left-0 right-0 flex justify-center gap-4 opacity-0 group-hover:opacity-100 transition-all z-50">
                        <button onclick="event.stopPropagation(); moveBrick(${idx}, 'left')" class="p-3 bg-ser-dark rounded-2xl text-white border border-white/10 hover:bg-black transition-all shadow-xl"><i data-lucide="chevron-left" class="w-6 h-6"></i></button>
                        <button onclick="event.stopPropagation(); moveBrick(${idx}, 'right')" class="p-3 bg-ser-dark rounded-2xl text-white border border-white/10 hover:bg-black transition-all shadow-xl"><i data-lucide="chevron-right" class="w-6 h-6"></i></button>
                    </div>
                `;
                wrapper.appendChild(piece);
            });
            timelineContainer.appendChild(wrapper);
            lucide.createIcons();
        }

        function removeBrick(idx) { 
            sequence.splice(idx, 1); 
            selectedIdx = null; 
            renderTimeline(); updateAnalysis(); updateInspector(); 
        }

        function moveBrick(idx, dir) {
            if (dir === 'left' && idx > 0) [sequence[idx], sequence[idx-1]] = [sequence[idx-1], sequence[idx]];
            else if (dir === 'right' && idx < sequence.length - 1) [sequence[idx], sequence[idx+1]] = [sequence[idx+1], sequence[idx]];
            renderTimeline(); updateAnalysis();
        }

        function updateAnalysis() {
            debuggerConsole.innerHTML = '';
            const bugs = [];
            if (sequence.length === 0) return;

            sequence.forEach((brick, i) => {
                const prev = sequence[i-1];
                if (['MODELO_VIDEO', 'MODELO_LIDER'].includes(brick.id) && (!prev || prev.id !== 'ENFOQUE')) {
                    bugs.push({ title: "Observación Pasiva", msg: `"${brick.label}" necesita una Pregunta de Enfoque previa.`, fix: "Añade [Enfoque] antes del modelo." });
                }
                if (brick.id === 'NOMBRAR_TECNICO' && (!prev || (prev.id !== 'GIRA_DISCUTE' && prev.id !== 'PREGUNTAR_VALOR'))) {
                    bugs.push({ title: "Suministro de Respuestas", msg: "Estás nombrando antes del descubrimiento grupal.", fix: "Añade [Gira/Discute] antes del nombre técnico." });
                }
            });

            if (!['OBJETIVO', 'HISTORIA'].includes(sequence[0]?.id)) {
                bugs.push({ title: "Sin Raíz", msg: "Toda sesión SER debe iniciar con un Objetivo o Historia.", fix: "Inicia con una pieza de Ejecución." });
            }

            if (bugs.length === 0) {
                debuggerConsole.innerHTML = `<div class="flex gap-5 text-emerald-400 bg-emerald-500/10 p-6 rounded-[2.5rem] border border-emerald-500/20 items-center"><i data-lucide="check-square" class="w-12 h-12 shrink-0"></i><p class="text-base font-bold uppercase tracking-widest leading-snug">Pipeline Validado. La sesión tiene una estructura de alto impacto académico.</p></div>`;
            }

            bugs.forEach(bug => {
                const d = document.createElement('div'); d.className = 'p-6 rounded-[2.5rem] border border-red-500/30 bg-red-500/5 space-y-3 animate-in slide-in-from-top';
                d.innerHTML = `<div class="flex gap-4 text-red-400"><i data-lucide="shield-alert" class="w-7 h-7 shrink-0"></i><p class="text-sm font-black uppercase tracking-widest">${bug.title}</p></div>
                               <p class="text-base font-medium opacity-80 pl-11">${bug.msg}</p>
                               <div class="flex gap-3 text-ser-cyan bg-ser-cyan/10 p-4 rounded-2xl border border-ser-cyan/20 items-center ml-11"><i data-lucide="wrench" class="w-5 h-5"></i><p class="text-[13px] font-black uppercase leading-tight">Solución SER: ${bug.fix}</p></div>`;
                debuggerConsole.appendChild(d);
            });
            lucide.createIcons();
        }

        function updateInspector() {
            const item = selectedIdx !== null ? sequence[selectedIdx] : previewItem;
            inspectorPanel.innerHTML = '';
            if (!item) {
                inspectorPanel.innerHTML = '<div class="h-full flex flex-col items-center justify-center text-neutral-300 text-center px-10 opacity-40"><i data-lucide="info" class="w-20 h-20 mb-6 text-neutral-200"></i><p class="font-bebas text-5xl tracking-widest uppercase leading-none">MODO INSPECTOR</p><p class="text-lg font-medium mt-4 leading-relaxed">Selecciona una pieza encastrada para ver la pauta oficial de la red SER.</p></div>';
                lucide.createIcons(); return;
            }
            const cat = CATEGORY_DATA[item.category];
            inspectorPanel.innerHTML = `
                <div class="h-full flex flex-col animate-in fade-in zoom-in-95 duration-300 overflow-hidden">
                    <div class="flex items-center justify-between mb-8 pb-8 border-b border-neutral-100">
                        <div class="flex items-center gap-6">
                            <div class="p-5 rounded-3xl ${cat.brickClass} text-white shadow-2xl"><i data-lucide="${item.icon}" class="w-8 h-8"></i></div>
                            <div><h3 class="font-bebas text-5xl tracking-wide text-neutral-800 leading-none">${item.label}</h3><p class="text-sm font-black uppercase tracking-[0.4em] ${cat.color} mt-1">${cat.label}</p></div>
                        </div>
                        ${previewItem ? `<div class="bg-ser-pink/10 text-ser-pink px-6 py-2 rounded-full text-xs font-black uppercase border-2 border-ser-pink/30 tracking-widest">Previsualización</div>` : ''}
                    </div>
                    <div class="flex-1 space-y-8 overflow-y-auto custom-scrollbar pr-4">
                        <div class="p-8 bg-neutral-50 rounded-[3rem] border border-neutral-100 relative shadow-inner">
                            <p class="text-[11px] text-neutral-400 uppercase font-black mb-3 tracking-[0.4em]">¿De qué se trata?</p>
                            <p class="text-2xl font-bold text-neutral-700 italic leading-relaxed">"${item.description}"</p>
                            
                            <div class="mt-8 pt-8 border-t border-neutral-200">
                                <p class="text-[11px] text-neutral-400 uppercase font-black mb-4 tracking-[0.4em]">Pauta de Retroalimentación de la red:</p>
                                <p class="text-xl text-neutral-600 leading-relaxed italic">"${item.reflection}"</p>
                            </div>
                        </div>
                        <div class="px-6 py-5 flex items-center gap-5 bg-emerald-500/5 rounded-3xl border border-emerald-500/10">
                            <div class="w-4 h-4 rounded-full bg-emerald-500 animate-ping"></div>
                            <p class="text-sm text-neutral-500 uppercase font-black tracking-widest leading-none">Resultado esperado: <span class="text-emerald-700 font-bold ml-2 text-xl italic underline">${item.impact}</span></p>
                        </div>
                    </div>
                </div>`;
            lucide.createIcons();
        }

        document.getElementById('shuffle-btn').onclick = () => {
            if (!isShuffled) {
                libraryKeys = libraryKeys.sort(() => Math.random() - 0.5);
                isShuffled = true; document.getElementById('shuffle-text').innerText = 'Ordenar Categorías';
                document.getElementById('challenge-mode').classList.remove('hidden');
            } else {
                libraryKeys = Object.keys(BRICK_DEFS);
                isShuffled = false; document.getElementById('shuffle-text').innerText = 'Revolver Librería';
                document.getElementById('challenge-mode').classList.add('hidden');
            }
            renderLibrary();
        };

        document.getElementById('clear-btn').onclick = () => {
            sequence = []; selectedIdx = null; previewItem = null;
            renderTimeline(); updateAnalysis(); updateInspector();
        };

        window.onload = () => { renderLibrary(); renderTimeline(); updateAnalysis(); updateInspector(); };
    </script>
</body>
</html>
